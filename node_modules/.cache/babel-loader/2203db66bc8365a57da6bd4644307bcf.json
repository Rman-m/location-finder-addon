{"ast":null,"code":"import _asyncToGenerator from\"/Users/arman/ip-prj/my-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/arman/ip-prj/my-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/arman/ip-prj/my-app/node_modules/@babel/runtime/regenerator/index.js\";/*global browser*/ /*global url*/import React,{useEffect,useState,useCallback}from\"react\";import loadingUrl from\"./img/loading.svg\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment2}from\"react/jsx-runtime\";function App(){var _Fragment;var _useState=useState({}),_useState2=_slicedToArray(_useState,2),urlData=_useState2[0],setUrlData=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),errorMessage=_useState4[0],setErrorMessage=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),tabUrl=_useState6[0],setTabUrl=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),loading=_useState8[0],setLoading=_useState8[1];var getUrl=useCallback(function(){setLoading(true);browser.tabs.query({currentWindow:true,active:true}).then(function(tabs){var x=new URL(tabs[0].url).hostname;console.log(x);setTabUrl(x);});},[setUrlData]);var fetchApi=useCallback(/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var response,jsonResponse;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;setLoading(true);if(!(tabUrl===\"\")){_context.next=4;break;}return _context.abrupt(\"return\");case 4:_context.next=6;return fetch(\"http://ip-api.com/json/\".concat(tabUrl));case 6:response=_context.sent;_context.next=9;return response.json();case 9:jsonResponse=_context.sent;if(!(jsonResponse.status===\"fail\")){_context.next=12;break;}throw new Error(\"something went wrong\");case 12:setUrlData(jsonResponse);_context.next=18;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);setErrorMessage(_context.t0.message);case 18:setLoading(false);case 19:case\"end\":return _context.stop();}}},_callee,null,[[0,15]]);})),[tabUrl]);useEffect(function(){getUrl();},[getUrl]);useEffect(function(){fetchApi();},[fetchApi]);console.log(\"red\");return/*#__PURE__*/_jsx(\"div\",{className:\"app\",children:loading?/*#__PURE__*/_jsx(\"img\",{src:loadingUrl}):(_Fragment=/*#__PURE__*/_jsxs(_Fragment2,{children:[/*#__PURE__*/_jsxs(\"p\",{children:[\" country: \",urlData.country]}),/*#__PURE__*/_jsxs(\"p\",{children:[\" city: \",urlData.city]})]}))!==null&&_Fragment!==void 0?_Fragment:errorMessage});}export default App;","map":{"version":3,"names":["React","useEffect","useState","useCallback","loadingUrl","App","urlData","setUrlData","errorMessage","setErrorMessage","tabUrl","setTabUrl","loading","setLoading","getUrl","browser","tabs","query","currentWindow","active","then","x","URL","url","hostname","console","log","fetchApi","fetch","response","json","jsonResponse","status","Error","message","country","city"],"sources":["/Users/arman/ip-prj/my-app/src/App.js"],"sourcesContent":["/*global browser*/\n/*global url*/\n\nimport React, { useEffect, useState, useCallback } from \"react\";\nimport loadingUrl from \"./img/loading.svg\";\nfunction App() {\n\tconst [urlData, setUrlData] = useState({});\n\tconst [errorMessage, setErrorMessage] = useState(\"\");\n\tconst [tabUrl, setTabUrl] = useState(\"\");\n\tconst [loading, setLoading] = useState(true);\n\n\tconst getUrl = useCallback(() => {\n\t\tsetLoading(true);\n\t\tbrowser.tabs.query({ currentWindow: true, active: true }).then((tabs) => {\n\t\t\tconst x = new URL(tabs[0].url).hostname;\n\t\t\tconsole.log(x);\n\t\t\tsetTabUrl(x);\n\t\t});\n\t}, [setUrlData]);\n\n\tconst fetchApi = useCallback(async () => {\n\t\ttry {\n\t\t\tsetLoading(true);\n\t\t\tif (tabUrl === \"\") return;\n\t\t\tconst response = await fetch(`http://ip-api.com/json/${tabUrl}`);\n\t\t\tconst jsonResponse = await response.json();\n\t\t\tif (jsonResponse.status === \"fail\")\n\t\t\t\tthrow new Error(\"something went wrong\");\n\t\t\tsetUrlData(jsonResponse);\n\t\t} catch (err) {\n\t\t\tsetErrorMessage(err.message);\n\t\t}\n\t\tsetLoading(false);\n\t}, [tabUrl]);\n\tuseEffect(() => {\n\t\tgetUrl();\n\t}, [getUrl]);\n\tuseEffect(() => {\n\t\tfetchApi();\n\t}, [fetchApi]);\n\tconsole.log(\"red\");\n\treturn (\n\t\t<div className=\"app\">\n\t\t\t{loading ? (\n\t\t\t\t<img src={loadingUrl} />\n\t\t\t) : (\n\t\t\t\t(\n\t\t\t\t\t<>\n\t\t\t\t\t\t<p> country: {urlData.country}</p>\n\t\t\t\t\t\t<p> city: {urlData.city}</p>\n\t\t\t\t\t</>\n\t\t\t\t) ?? errorMessage\n\t\t\t)}\n\t\t</div>\n\t);\n}\n\nexport default App;\n"],"mappings":"mVAAA,kB,CACA,cAEA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,WAArC,KAAwD,OAAxD,CACA,MAAOC,CAAAA,UAAP,KAAuB,mBAAvB,C,8IACA,QAASC,CAAAA,GAAT,EAAe,eACd,cAA8BH,QAAQ,CAAC,EAAD,CAAtC,wCAAOI,OAAP,eAAgBC,UAAhB,eACA,eAAwCL,QAAQ,CAAC,EAAD,CAAhD,yCAAOM,YAAP,eAAqBC,eAArB,eACA,eAA4BP,QAAQ,CAAC,EAAD,CAApC,yCAAOQ,MAAP,eAAeC,SAAf,eACA,eAA8BT,QAAQ,CAAC,IAAD,CAAtC,yCAAOU,OAAP,eAAgBC,UAAhB,eAEA,GAAMC,CAAAA,MAAM,CAAGX,WAAW,CAAC,UAAM,CAChCU,UAAU,CAAC,IAAD,CAAV,CACAE,OAAO,CAACC,IAAR,CAAaC,KAAb,CAAmB,CAAEC,aAAa,CAAE,IAAjB,CAAuBC,MAAM,CAAE,IAA/B,CAAnB,EAA0DC,IAA1D,CAA+D,SAACJ,IAAD,CAAU,CACxE,GAAMK,CAAAA,CAAC,CAAG,GAAIC,CAAAA,GAAJ,CAAQN,IAAI,CAAC,CAAD,CAAJ,CAAQO,GAAhB,EAAqBC,QAA/B,CACAC,OAAO,CAACC,GAAR,CAAYL,CAAZ,EACAV,SAAS,CAACU,CAAD,CAAT,CACA,CAJD,EAKA,CAPyB,CAOvB,CAACd,UAAD,CAPuB,CAA1B,CASA,GAAMoB,CAAAA,QAAQ,CAAGxB,WAAW,sEAAC,6KAE3BU,UAAU,CAAC,IAAD,CAAV,CAF2B,KAGvBH,MAAM,GAAK,EAHY,wFAIJkB,CAAAA,KAAK,kCAA2BlB,MAA3B,EAJD,QAIrBmB,QAJqB,qCAKAA,CAAAA,QAAQ,CAACC,IAAT,EALA,QAKrBC,YALqB,oBAMvBA,YAAY,CAACC,MAAb,GAAwB,MAND,gCAOpB,IAAIC,CAAAA,KAAJ,CAAU,sBAAV,CAPoB,SAQ3B1B,UAAU,CAACwB,YAAD,CAAV,CAR2B,iFAU3BtB,eAAe,CAAC,YAAIyB,OAAL,CAAf,CAV2B,QAY5BrB,UAAU,CAAC,KAAD,CAAV,CAZ4B,qEAAD,GAazB,CAACH,MAAD,CAbyB,CAA5B,CAcAT,SAAS,CAAC,UAAM,CACfa,MAAM,GACN,CAFQ,CAEN,CAACA,MAAD,CAFM,CAAT,CAGAb,SAAS,CAAC,UAAM,CACf0B,QAAQ,GACR,CAFQ,CAEN,CAACA,QAAD,CAFM,CAAT,CAGAF,OAAO,CAACC,GAAR,CAAY,KAAZ,EACA,mBACC,YAAK,SAAS,CAAC,KAAf,UACEd,OAAO,cACP,YAAK,GAAG,CAAER,UAAV,EADO,yBAIN,yCACC,kCAAcE,OAAO,CAAC6B,OAAtB,GADD,cAEC,+BAAW7B,OAAO,CAAC8B,IAAnB,GAFD,GAJM,uCAQF5B,YATP,EADD,CAcA,CAED,cAAeH,CAAAA,GAAf"},"metadata":{},"sourceType":"module"}